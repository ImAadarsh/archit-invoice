<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
  <!-- Meta Tags -->
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Laralink">
  <!-- Site Title -->
  <title>Archit Invoice | Bulk Download</title>
  <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
  <div class="tm_container">
    <div class="tm_invoice_wrap">
      <!-- Invoices will be populated here -->
      <div id="invoices"></div>
    </div>
  </div>
  <script src="assets/js/jquery.min.js"></script>
  <script>
    $(document).ready(function() {
      // Extract business ID and location ID
      var businessId = 6; // Example: replace with actual business ID
      var locationId = 1; // Example: replace with actual location ID

      // Fetch all invoices
      $.ajax({
        url: 'http://127.0.0.1:8000/api/getAllInvoices',
        type: 'GET',
        success: function(allInvoicesResponse) {
          // Iterate through all invoices
          allInvoicesResponse.data.forEach(function(invoiceData) {
            // Fetch detailed invoice for each invoice
            $.ajax({
              url: 'https://api.architartgallery.in/public/api/getDetailedInvoice/' + invoiceData.id,
              type: 'GET',
              success: function(detailedInvoiceResponse) {
                // Populate HTML elements with detailed invoice data
                populateInvoiceTemplate(detailedInvoiceResponse.data);
              },
              error: function(xhr, status, error) {
                console.error('Error fetching detailed invoice data:', error);
              }
            });
          });
        },
        error: function(xhr, status, error) {
          console.error('Error fetching all invoices:', error);
        }
      });

      // Function to populate HTML template with invoice data
      function populateInvoiceTemplate(invoiceData) {
        var invoiceTemplate = `
          <div class="tm_invoice_head">
            <!-- Invoice header content -->
            <h2>Invoice No: ${invoiceData.serial_no}</h2>
            <p>Payment Method: ${invoiceData.payment_mode}</p>
            <p>Date: ${invoiceData.invoice_date}</p>
          </div>
          <div class="tm_invoice_info">
            <!-- Invoice info content -->
            <p>Customer: ${invoiceData.name}</p>
            <p>Address: ${invoiceData.billing_address.address_1}, ${invoiceData.billing_address.address_2}, ${invoiceData.billing_address.city}, ${invoiceData.billing_address.state}, ${invoiceData.billing_address.pincode}</p>
          </div>
          <div class="tm_invoice_items">
            <!-- Invoice items table -->
            <table>
              <thead>
                <tr>
                  <th>Item Name</th>
                  <th>Quantity</th>
                  <th>Unit Price</th>
                  <th>Total Price</th>
                </tr>
              </thead>
              <tbody>
                ${populateInvoiceItems(invoiceData.items)}
              </tbody>
            </table>
          </div>
        `;
        $('#invoices').append(invoiceTemplate);
      }

      // Function to populate invoice items
      function populateInvoiceItems(items) {
        var itemDetailsHtml = '';
        items.forEach(function(item) {
          itemDetailsHtml += `
            <tr>
              <td>${item.product.name}</td>
              <td>${item.quantity}</td>
              <td>${item.price_of_one}</td>
              <td>${item.price_of_all}</td>
            </tr>
          `;
        });
        return itemDetailsHtml;
      }
    });
  </script>
</body>

</html>
